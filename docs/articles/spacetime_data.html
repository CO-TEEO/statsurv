<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="statsurv">
<title>Spacetime Data in statsurv • statsurv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spacetime Data in statsurv">
<meta property="og:description" content="statsurv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">statsurv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/spacetime_data.html">Spacetime Data in statsurv</a>
    <a class="dropdown-item" href="../articles/statsurv_overview.html">An introduction to `statsurv`</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CO-TEEO/statsurv/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Spacetime Data in statsurv</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CO-TEEO/statsurv/blob/HEAD/vignettes/spacetime_data.Rmd" class="external-link"><code>vignettes/spacetime_data.Rmd</code></a></small>
      <div class="d-none name"><code>spacetime_data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CO-TEEO/statsurv" class="external-link">statsurv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>By it’s nature, statistical surveillance deals with data over time.
In many instances, the data is also collected at multiple spatial
locations as well. There are a number of sophisticated packages for
dealing with spacetime data in R, including the <a href="https://github.com/edzer/spacetime" class="external-link">spacetime</a> and <a href="https://r-spatial.github.io/stars/" class="external-link">stars</a> packages. However,
neither of these packages is quite right for the needs of the
<code>statsurv</code> package. They’re tricky to work with, often
focused on raster data, and are generally <em>way</em> more powerful
than we need.</p>
<p>Instead, the <code>statsurv</code> package represents spacetime data
in ordinary data frames that follow some specific conventions. These
data frames must contain the columns <code>id_space</code> and
<code>id_time</code>, that are each a set of consecutive integers. The
column <code>id_time</code> identifies the time point associated with
each row of the data frame, with lower numbers being earlier and higher
numbers being later. The column <code>id_space</code> identifies the
spatial location or area associated with each row. The specific values
of <code>id_space</code> are not assumed to have any meaning or order
beyond identification.</p>
<p><code>statsurv</code> also generally expects the spacetime data to be
<em>complete</em>, that is, every combination of <code>id_space</code>
and <code>id_time</code> is associated with exactly one row in the data
frame. This constraint is not strictly enforced, but you may get strange
results if this is not true.</p>
<p>So this would be a data frame following these conventions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">valid_data</span></span>
<span><span class="co">#&gt;   id_space id_time   y</span></span>
<span><span class="co">#&gt; 1        1       1 0.4</span></span>
<span><span class="co">#&gt; 2        2       1 0.5</span></span>
<span><span class="co">#&gt; 3        1       2 0.7</span></span>
<span><span class="co">#&gt; 4        2       2 0.8</span></span></code></pre></div>
<p>And this one would not, because the entries for <code>id_space</code>
aren’t consecutive integers:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">invalid_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id_space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span>, <span class="fl">1</span>, <span class="fl">2.5</span><span class="op">)</span>,</span>
<span>                           id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">invalid_data</span></span>
<span><span class="co">#&gt;   id_space id_time    y</span></span>
<span><span class="co">#&gt; 1      1.0       1 -1.0</span></span>
<span><span class="co">#&gt; 2      2.5       1 -2.0</span></span>
<span><span class="co">#&gt; 3      1.0       2 -0.5</span></span>
<span><span class="co">#&gt; 4      2.5       2 -8.0</span></span></code></pre></div>
<p>If you’re even unsure about whether you’re data is correctly
formatted for <code>statsurv</code>, you can call the function
<code>validate_spacetime_data</code>, which will give an error if the
data frame does not follow the spacetime data conventions:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validate_spacetime_data.html">validate_spacetime_data</a></span><span class="op">(</span><span class="va">valid_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/validate_spacetime_data.html">validate_spacetime_data</a></span><span class="op">(</span><span class="va">invalid_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `validate_spacetime_data()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> The column 'id_space' must be made of whole numbers with no gaps or skips</span></span></code></pre></div>
<div class="section level2">
<h2 id="creating-spacetime-data">Creating Spacetime data<a class="anchor" aria-label="anchor" href="#creating-spacetime-data"></a>
</h2>
<p>Often, the hardest part of any data analysis is getting data in the
right format. Here are two common formats you might have the data in,
and how to get it into the right format for the <code>statsurv</code>
package</p>
<div class="section level3">
<h3 id="point-data">Point data<a class="anchor" aria-label="anchor" href="#point-data"></a>
</h3>
<p>Often, the underlying data comes as a series of points. For example,
elevated blood lead levels are reported based on a geo-coded address and
a date. To work with this data in <code>statsurv</code>, the point data
needs to be aggregated in both space and time.</p>
<p>Suppose we had the following set of data, with raw latitude,
longitude, and date, and we wanted to assign these points to a month and
a county in New Mexico:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.579</span>, <span class="fl">36.382</span>, <span class="fl">35.863</span>, <span class="fl">32.539</span>, <span class="fl">34.876</span>, <span class="fl">38.876</span><span class="op">)</span>,</span>
<span>                         lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">105.143</span>, <span class="op">-</span><span class="fl">106.882</span>, <span class="op">-</span><span class="fl">103.552</span>, <span class="op">-</span><span class="fl">108.089</span>, <span class="op">-</span><span class="fl">106.454</span>, <span class="op">-</span><span class="fl">106.454</span><span class="op">)</span>,</span>
<span>                         date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"03/14/19"</span>, <span class="st">"2/11/19"</span>, <span class="st">"4/4/19"</span>, <span class="st">"5/8/19"</span>, <span class="st">"7/10/19"</span>, <span class="st">"2/12/19"</span><span class="op">)</span>,</span>
<span>                         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">6</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">point_data</span>             </span>
<span><span class="co">#&gt;      lat      lon     date         y</span></span>
<span><span class="co">#&gt; 1 34.579 -105.143 03/14/19 0.8117515</span></span>
<span><span class="co">#&gt; 2 36.382 -106.882  2/11/19 4.4761807</span></span>
<span><span class="co">#&gt; 3 35.863 -103.552   4/4/19 6.7324410</span></span>
<span><span class="co">#&gt; 4 32.539 -108.089   5/8/19 3.4041678</span></span>
<span><span class="co">#&gt; 5 34.876 -106.454  7/10/19 2.2634268</span></span>
<span><span class="co">#&gt; 6 38.876 -106.454  2/12/19 7.7451168</span></span></code></pre></div>
<p>One way to do this is with the <code>sf</code> and
<code>lubridate</code> packages. To assign the points to a county, first
we need to load up the county boundaries:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NM_county_sf"</span><span class="op">)</span></span></code></pre></div>
<p>Then, we convert our point data into an sf, use a spatial join to
assign them to counties, and then use <code>match</code> to convert
county names into an id:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geo_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">point_data</span>, </span>
<span>                   coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,</span>
<span>                   crs <span class="op">=</span> <span class="st">"+proj=longlat"</span>,</span>
<span>                   remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geo_data</span> <span class="op">&lt;-</span> <span class="va">geo_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">NM_county_sf</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geo_data_w_county</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">geo_data</span>, <span class="va">NM_county_sf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">county</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">geo_data_w_county</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 209887.5 ymin: 3604391 xmax: 630734.5 ymax: 4027964</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt;      lat      lon     date         y id_space    county</span></span>
<span><span class="co">#&gt; 1 34.579 -105.143 03/14/19 0.8117515        1 guadalupe</span></span>
<span><span class="co">#&gt; 2 36.382 -106.882  2/11/19 4.4761807        2 rioarriba</span></span>
<span><span class="co">#&gt; 3 35.863 -103.552   4/4/19 6.7324410        3   harding</span></span>
<span><span class="co">#&gt; 4 32.539 -108.089   5/8/19 3.4041678        4     grant</span></span>
<span><span class="co">#&gt; 5 34.876 -106.454  7/10/19 2.2634268        5  valencia</span></span>
<span><span class="co">#&gt;                   geometry</span></span>
<span><span class="co">#&gt; 1 POINT (486884.5 3826367)</span></span>
<span><span class="co">#&gt; 2 POINT (331192.5 4027964)</span></span>
<span><span class="co">#&gt; 3 POINT (630734.5 3969721)</span></span>
<span><span class="co">#&gt; 4 POINT (209887.5 3604391)</span></span>
<span><span class="co">#&gt; 5 POINT (367115.3 3860256)</span></span></code></pre></div>
<p>Assigning points to months is a little more straightforward. We need
to convert our characters to dates, use <code>floor_date</code> to
figure out which month a date belongs to, and then convert that date to
a number. For the last step we can use the function <code>match</code>,
but we have to be careful if there are gaps in our data.</p>
<p>The first steps are the same for both methods:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span><span class="va">curr_data</span> <span class="op">&lt;-</span> <span class="va">geo_data_w_county</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">mdy</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>,</span>
<span>         month_date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">date</span>, unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If there are no gaps in your data, then we can do it all in one
line:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">option1</span> <span class="op">&lt;-</span> <span class="va">curr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">month_date</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">month_date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">option1</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 209887.5 ymin: 3604391 xmax: 630734.5 ymax: 4027964</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt;      lat      lon       date         y id_space    county</span></span>
<span><span class="co">#&gt; 1 34.579 -105.143 2019-03-14 0.8117515        1 guadalupe</span></span>
<span><span class="co">#&gt; 2 36.382 -106.882 2019-02-11 4.4761807        2 rioarriba</span></span>
<span><span class="co">#&gt; 3 35.863 -103.552 2019-04-04 6.7324410        3   harding</span></span>
<span><span class="co">#&gt; 4 32.539 -108.089 2019-05-08 3.4041678        4     grant</span></span>
<span><span class="co">#&gt; 5 34.876 -106.454 2019-07-10 2.2634268        5  valencia</span></span>
<span><span class="co">#&gt;                   geometry month_date id_time</span></span>
<span><span class="co">#&gt; 1 POINT (486884.5 3826367) 2019-03-01       2</span></span>
<span><span class="co">#&gt; 2 POINT (331192.5 4027964) 2019-02-01       1</span></span>
<span><span class="co">#&gt; 3 POINT (630734.5 3969721) 2019-04-01       3</span></span>
<span><span class="co">#&gt; 4 POINT (209887.5 3604391) 2019-05-01       4</span></span>
<span><span class="co">#&gt; 5 POINT (367115.3 3860256) 2019-07-01       5</span></span></code></pre></div>
<p>The other option is to calculate our dates explicitly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">curr_data</span><span class="op">$</span><span class="va">month_date</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">curr_data</span><span class="op">$</span><span class="va">month_date</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="va">option2</span> <span class="op">&lt;-</span> <span class="va">curr_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">month_date</span>, <span class="va">time_levels</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">option2</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 209887.5 ymin: 3604391 xmax: 630734.5 ymax: 4027964</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt;      lat      lon       date         y id_space    county</span></span>
<span><span class="co">#&gt; 1 34.579 -105.143 2019-03-14 0.8117515        1 guadalupe</span></span>
<span><span class="co">#&gt; 2 36.382 -106.882 2019-02-11 4.4761807        2 rioarriba</span></span>
<span><span class="co">#&gt; 3 35.863 -103.552 2019-04-04 6.7324410        3   harding</span></span>
<span><span class="co">#&gt; 4 32.539 -108.089 2019-05-08 3.4041678        4     grant</span></span>
<span><span class="co">#&gt; 5 34.876 -106.454 2019-07-10 2.2634268        5  valencia</span></span>
<span><span class="co">#&gt;                   geometry month_date id_time</span></span>
<span><span class="co">#&gt; 1 POINT (486884.5 3826367) 2019-03-01       2</span></span>
<span><span class="co">#&gt; 2 POINT (331192.5 4027964) 2019-02-01       1</span></span>
<span><span class="co">#&gt; 3 POINT (630734.5 3969721) 2019-04-01       3</span></span>
<span><span class="co">#&gt; 4 POINT (209887.5 3604391) 2019-05-01       4</span></span>
<span><span class="co">#&gt; 5 POINT (367115.3 3860256) 2019-07-01       6</span></span></code></pre></div>
<p>Since we have gaps in our data, <code>option2</code> is better in
this example. We can then aggregate our data for use in statistical
surveillance:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggregated_data</span> <span class="op">&lt;-</span> <span class="va">option2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_space</span>, <span class="va">id_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id_space'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">aggregated_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 x 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   id_space [5]</span></span></span>
<span><span class="co">#&gt;   id_space id_time     y</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        1       2 0.812</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        2       1 4.48 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        3       3 6.73 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>        4       4 3.40 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>        5       6 2.26</span></span></code></pre></div>
<p>However, we still don’t have valid spacetime data, because we have
gaps in <code>id_time</code>. So we can pad our data frame:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coord_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>id_space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">aggregated_data</span><span class="op">$</span><span class="va">id_space</span><span class="op">)</span>,</span>
<span>                         id_time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">aggregated_data</span><span class="op">$</span><span class="va">id_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">padded_aggregated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">aggregated_data</span>, <span class="va">coord_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id_space</span>, <span class="va">id_time</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = c("id_space", "id_time")</span></span>
<span><span class="va">padded_aggregated_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 x 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   id_space [5]</span></span></span>
<span><span class="co">#&gt;    id_space id_time      y</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1       1 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        1       2  0.812</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        1       3 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        1       4 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        1       5 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        1       6 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        2       1  4.48 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        2       2 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        2       3 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        2       4 <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 20 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="../reference/validate_spacetime_data.html">validate_spacetime_data</a></span><span class="op">(</span><span class="va">padded_aggregated_data</span><span class="op">)</span></span></code></pre></div>
<p>That’s a little annoying to do by hand, so we could also use the
function <code>pad_spacetime_data</code> to do it automatically:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">padded_aggregated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pad_spacetime_data.html">pad_spacetime_data</a></span><span class="op">(</span><span class="va">aggregated_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_spacetime_data.html">validate_spacetime_data</a></span><span class="op">(</span><span class="va">padded_aggregated_data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sf-data">sf data<a class="anchor" aria-label="anchor" href="#sf-data"></a>
</h3>
<p>Another situation is where the data is stored as an sf object with an
additional field for time.</p>
<p>As an example, let’s take this example with fake data from New
Mexico. We have 3 time points for each geometry, as well as the county
name.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NM_sample_sf</span></span>
<span><span class="co">#&gt; Simple feature collection with 96 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 114557.3 ymin: 3471000 xmax: 682840.2 ymax: 4102426</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 96 x 4</span></span></span>
<span><span class="co">#&gt;          y date       county                                            geometry</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        <span style="color: #949494; font-style: italic;">&lt;POLYGON [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.493   2022-01-01 bernalillo ((374492.6 3859524, 371038.3 3859562, 371039.8~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.649   2022-02-01 bernalillo ((374492.6 3859524, 371038.3 3859562, 371039.8~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.003<span style="text-decoration: underline;">81</span> 2022-03-01 bernalillo ((374492.6 3859524, 371038.3 3859562, 371039.8~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.133   2022-01-01 catron     ((125979.7 3764745, 126150.3 3769552, 126350.9~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.115   2022-02-01 catron     ((125979.7 3764745, 126150.3 3769552, 126350.9~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.480   2022-03-01 catron     ((125979.7 3764745, 126150.3 3769552, 126350.9~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.434   2022-01-01 chaves     ((563052.3 3761894, 569725.2 3761914, 577922 3~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.950   2022-02-01 chaves     ((563052.3 3761894, 569725.2 3761914, 577922 3~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.339   2022-03-01 chaves     ((563052.3 3761894, 569725.2 3761914, 577922 3~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.445   2022-01-01 colfax     ((509971.1 4012919, 504328.5 4012914, 499949.7~</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 86 more rows</span></span></span></code></pre></div>
<p>Because we have the county name, we can ignore the geometry and
create <code>id_space</code> based on the county names.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NM_sample_sf_id</span> <span class="op">&lt;-</span> <span class="va">NM_sample_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">county</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">NM_sample_sf_id</span></span>
<span><span class="co">#&gt; Simple feature collection with 96 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 114557.3 ymin: 3471000 xmax: 682840.2 ymax: 4102426</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 96 x 6</span></span></span>
<span><span class="co">#&gt;          y date       county                            geometry id_sp~1 id_time</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;POLYGON [m]&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.493   2022-01-01 bernalillo ((374492.6 3859524, 371038.3 3~       1       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.649   2022-02-01 bernalillo ((374492.6 3859524, 371038.3 3~       1       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.003<span style="text-decoration: underline;">81</span> 2022-03-01 bernalillo ((374492.6 3859524, 371038.3 3~       1       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.133   2022-01-01 catron     ((125979.7 3764745, 126150.3 3~       2       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.115   2022-02-01 catron     ((125979.7 3764745, 126150.3 3~       2       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.480   2022-03-01 catron     ((125979.7 3764745, 126150.3 3~       2       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.434   2022-01-01 chaves     ((563052.3 3761894, 569725.2 3~       3       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.950   2022-02-01 chaves     ((563052.3 3761894, 569725.2 3~       3       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.339   2022-03-01 chaves     ((563052.3 3761894, 569725.2 3~       3       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.445   2022-01-01 colfax     ((509971.1 4012919, 504328.5 4~       4       1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 86 more rows, and abbreviated variable name 1: id_space</span></span></span></code></pre></div>
<p>It’s often also easier to split the data into two tables, one with
the aggregated data, and one with the spatial information</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NM_sample_data</span> <span class="op">&lt;-</span> <span class="va">NM_sample_sf_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NM_sample_geom</span> <span class="op">&lt;-</span> <span class="va">NM_sample_sf_id</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_space</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_space</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NM_sample_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 96 x 5</span></span></span>
<span><span class="co">#&gt;          y date       county     id_space id_time</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.493   2022-01-01 bernalillo        1       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.649   2022-02-01 bernalillo        1       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.003<span style="text-decoration: underline;">81</span> 2022-03-01 bernalillo        1       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.133   2022-01-01 catron            2       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.115   2022-02-01 catron            2       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.480   2022-03-01 catron            2       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.434   2022-01-01 chaves            3       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.950   2022-02-01 chaves            3       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.339   2022-03-01 chaves            3       3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.445   2022-01-01 colfax            4       1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 86 more rows</span></span></span>
<span></span>
<span><span class="va">NM_sample_geom</span></span>
<span><span class="co">#&gt; Simple feature collection with 32 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 114557.3 ymin: 3471000 xmax: 682840.2 ymax: 4102426</span></span>
<span><span class="co">#&gt; CRS:           +proj=utm +zone=13</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 32 x 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   id_space [32]</span></span></span>
<span><span class="co">#&gt;    id_space                                                             geometry</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                                                       <span style="color: #949494; font-style: italic;">&lt;GEOMETRY [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>        1 POLYGON ((374492.6 3859524, 371038.3 3859562, 371039.8 3860579, 371~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>        2 POLYGON ((125979.7 3764745, 126150.3 3769552, 126350.9 3774176, 126~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>        3 POLYGON ((563052.3 3761894, 569725.2 3761914, 577922 3761968, 57788~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>        4 POLYGON ((509971.1 4012919, 504328.5 4012914, 499949.7 4012870, 498~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        5 GEOMETRYCOLLECTION (MULTIPOLYGON (((637673.3 3849533, 640863.6 3849~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        6 GEOMETRYCOLLECTION (MULTIPOLYGON (((526127.5 3762059, 519766.1 3762~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        7 GEOMETRYCOLLECTION (POLYGON ((284078 3598156, 284170.6 3600224, 284~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        8 POLYGON ((563319.6 3540653, 550400.7 3540573, 544243 3540566, 54021~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        9 POLYGON ((158862.9 3680471, 160064.1 3680425, 160059.7 3680246, 162~</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       10 MULTIPOLYGON (((473385.2 3844025, 473385.2 3844025, 473385.2 384402~</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ... with 22 more rows</span></span></span></code></pre></div>
<p>But what if we don’t have any labels for the spatial areas, beyond
the geometries? Well then it’s a little trickier, but still
manageable.</p>
<p>We can select only the distinct geometries, and assign each one an
id_space:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NM_geometries</span> <span class="op">&lt;-</span> <span class="va">NM_sample_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> </span>
<span><span class="va">NM_geometries</span><span class="op">$</span><span class="va">id_space</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NM_geometries</span><span class="op">)</span></span></code></pre></div>
<p>Then we use an st_join to line them up with the sample data:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NM_spacetime_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">NM_sample_sf</span>, <span class="va">NM_geometries</span>, join <span class="op">=</span> <span class="va">st_equals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate_spacetime_data.html">validate_spacetime_data</a></span><span class="op">(</span><span class="va">NM_spacetime_data</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we have data organized in the way that <code>statsurv</code>
expects. Maybe not as quickly or as easily as we expected though. For
better or for worse though, most of the difficulty comes from having to
aggregate the data into spatial areas and time blocks. Once you’ve done
that, it should just take a couple
<code>mutate</code>/<code>match</code> calls to get it into the form
expected by <code>statsurv</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Paul Romer Present.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
